{% for account in accounts %}
  {% set isWritableString = 'true' if account.isWritable else 'false' %}
  // {{ account.titleCaseName }}{% if account.isOptional %} (optional){% endif %}.
  {% if account.isOptional or account.hasDefaultValue %}
  if ({{ accountsObj }}.{{ account.name }}) {
  {% endif %}
    {% if account.isOptionalSigner %}
      if (isSigner({{ accountsObj }}.{{ account.name }})) {
        signers.push({{ accountsObj }}.{{ account.name }});
        keys.push({ pubkey: {{ accountsObj }}.{{ account.name }}.publicKey, isSigner: true, isWritable: {{ isWritableString }} });
      } else {
        keys.push({ pubkey: {{ accountsObj }}.{{ account.name }}, isSigner: false, isWritable: {{ isWritableString }} });
      }
    {% elif account.isSigner  %}
      signers.push({{ accountsObj }}.{{ account.name }});
      keys.push({ pubkey: {{ accountsObj }}.{{ account.name }}.publicKey, isSigner: true, isWritable: {{ isWritableString }} });
    {% else %}
      keys.push({ pubkey: {{ accountsObj }}.{{ account.name }}, isSigner: false, isWritable: {{ isWritableString }} });
    {% endif %}
  {% if account.isOptional %}
  }
  {% elif account.hasDefaultValue %}
  } else {
    {% if account.defaultsTo.kind === 'program' %}
      keys.push({ pubkey: getProgramAddressWithFallback(context, '{{ account.defaultsTo.program.name }}', '{{ account.defaultsTo.program.address }}'), isSigner: false, isWritable: false });
    {% elif account.defaultsTo.kind === 'address' %}
      keys.push({ pubkey: context.eddsa.createPublicKey('{{ account.defaultsTo.address }}'), isSigner: false, isWritable: {{ isWritableString }} });
    {% elif account.defaultsTo.kind === 'identity' and (account.isSigner or account.isOptionalSigner) %}
      signers.push(context.identity);
      keys.push({ pubkey: context.identity.publicKey, isSigner: true, isWritable: {{ isWritableString }} });
    {% elif account.defaultsTo.kind === 'identity' %}
      keys.push({ pubkey: context.identity.publicKey, isSigner: false, isWritable: {{ isWritableString }} });
    {% elif account.defaultsTo.kind === 'payer' and (account.isSigner or account.isOptionalSigner) %}
      signers.push(context.payer);
      keys.push({ pubkey: context.payer.publicKey, isSigner: true, isWritable: {{ isWritableString }} });
    {% elif account.defaultsTo.kind === 'payer' %}
      keys.push({ pubkey: context.identity, isSigner: false, isWritable: {{ isWritableString }} });
    {% else %}
      keys.push({ pubkey: programId, isSigner: false, isWritable: false });
    {% endif %}
  }
  {% endif %}

{% endfor %}